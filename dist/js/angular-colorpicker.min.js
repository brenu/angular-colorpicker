angular.module("ui.colorpicker",[]).value("colorpicker.language",{"zh-cn":{PALETTE:"经典",WHEEL:"自定义",HISTORY:"历史记录",SELECT:"选择",CANCEL:"取消"},"zh-tw":{PALETTE:"經典",WHEEL:"自定義",HISTORY:"歷史記錄",SELECT:"選擇",CANCEL:"取消"},en:{PALETTE:"Palette",WHEEL:"Wheel",HISTORY:"History",SELECT:"Select",CANCEL:"Cancel"},fr:{PALETTE:"Palette",WHEEL:"Roue",HISTORY:"Historique",SELECT:"Sélectionner",CANCEL:"Annuler"},pt:{PALETTE:"Paleta",WHEEL:"Personalizar",HISTORY:"Recentes",SELECT:"Selecionar",CANCEL:"Cancelar"}}).factory("colorpicker.helper",["$document",function(r){return{setCookie:function(r,o){var a=30,e=new Date;e.setTime(e.getTime()+24*a*60*60*1e3),document.cookie=r+"="+escape(o)+";expires="+e.toGMTString()},getCookie:function(r){var o,a=new RegExp("(^| )"+r+"=([^;]*)(;|$)");return(o=document.cookie.match(a))?unescape(o[2]):null},deleteCookie:function(r){var o=new Date;o.setTime(o.getTime()-1);var a=getCookie(r);null!=a&&(document.cookie=r+"="+a+";expires="+o.toGMTString())},enabledCookie:function(r){return"string"==typeof this.getCookie(r)},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(r){return[r[1],r[2],r[3],r[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(r){return[2.55*r[1],2.55*r[2],2.55*r[3],r[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(r){return[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(r){return[parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16),parseInt(r[3]+r[3],16)]}}]}}]).factory("colorpicker.transColor",["colorpicker.helper",function(r){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var r=this.toRGB();return"rgb("+r.r+","+r.g+","+r.b+")"},rgba:function(){var r=this.toRGB();return"rgba("+r.r+","+r.g+","+r.b+","+r.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(r,o,a,e){r/=255,o/=255,a/=255;var t,i,n,s;return n=Math.max(r,o,a),s=n-Math.min(r,o,a),t=0===s?null:n===r?(o-a)/s:n===o?(a-r)/s+2:(r-o)/s+4,t=(t+360)%6*60/360,i=0===s?0:s/n,{h:t||1,s:i,b:n,a:e||1}},setColor:function(o){o=o.toLowerCase();for(var a in r.stringParsers)if(r.stringParsers.hasOwnProperty(a)){var e=r.stringParsers[a],t=e.re.exec(o),i=t&&e.parse(t);if(i)return this.value=this.RGBtoHSB.apply(null,i),!1}},setHue:function(r){this.value.h=1-r},setSaturation:function(r){this.value.s=r},setLightness:function(r){this.value.b=1-r},setAlpha:function(r){this.value.a=parseInt(100*(1-r),10)/100},toRGB:function(r,o,a,e){r||(r=this.value.h,o=this.value.s,a=this.value.b),r*=360;var t,i,n,s,l;return r=r%360/60,l=a*o,s=l*(1-Math.abs(r%2-1)),t=i=n=a-l,r=~~r,t+=[l,s,0,0,s,l][r],i+=[s,l,l,s,0,0][r],n+=[0,0,s,l,l,s][r],{r:Math.round(255*t),g:Math.round(255*i),b:Math.round(255*n),a:e||this.value.a}},toHex:function(r,o,a,e){var t=this.toRGB(r,o,a,e);return"#"+(1<<24|parseInt(t.r,10)<<16|parseInt(t.g,10)<<8|parseInt(t.b,10)).toString(16).substr(1)}}}]).factory("colorpicker.slider",function(){"use strict";var r={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},o={};return{getOffset:function(r){for(var o=0,a=0,e=r.getBoundingClientRect();r&&!isNaN(r.offsetLeft)&&!isNaN(r.offsetTop);)"BODY"===r.tagName?(o+=document.documentElement.scrollLeft||r.scrollLeft,a+=document.documentElement.scrollTop||r.scrollTop):(o+=r.scrollLeft,a+=r.scrollTop),r=r.offsetParent;return{top:e.top+window.pageYOffset,left:e.left-130+window.pageXOffset,scrollX:o,scrollY:a}},closestSlider:function(r){var o=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector;return o.bind(r)("I")?r.parentNode:r},getSlider:function(){return r},getLeftPosition:function(a){return Math.max(0,Math.min(r.maxLeft,r.left+((a.pageX||o.left)-o.left)))},getTopPosition:function(a){return Math.max(0,Math.min(r.maxTop,r.top+((a.pageY||o.top)-o.top)))},setSlider:function(a){var e=this.closestSlider(a.target),t=this.getOffset(e),i=e.getBoundingClientRect(),n=a.clientX-i.left,s=a.clientY-i.top;r.knob=e.children[0].style,r.left=a.pageX-t.left-window.pageXOffset+t.scrollX,r.top=a.pageY-t.top-window.pageYOffset+t.scrollY,o={left:a.pageX-(n-r.left),top:a.pageY-(s-r.top)}},setSaturation:function(o){r={maxLeft:200,maxTop:200,callLeft:"setSaturation",callTop:"setLightness"},this.setSlider(o)},setHue:function(o){r={maxLeft:0,maxTop:200,callLeft:!1,callTop:"setHue"},this.setSlider(o)},setAlpha:function(o){r={maxLeft:0,maxTop:200,callLeft:!1,callTop:"setAlpha"},this.setSlider(o)},setKnob:function(o,a){r.knob.top=o+"px",r.knob.left=a+"px"}}}).directive("colorpicker",["$document","$compile","colorpicker.language","colorpicker.transColor","colorpicker.slider","colorpicker.helper",function(r,o,a,e,t,i){"use strict";return{restrict:"AE",replace:!0,scope:{color:"="},template:'<div class="colorpicker-circle">    <div class="circle-inner" ng-style="{\'background-color\':color}"></div></div>',link:function(n,s,l,c){function g(){clearTimeout(S),S=setTimeout(function(){m.css(M()),clearTimeout(S)},100)}n.show=!1,n.colorTab=1,n.colorboxs=["rgba(0, 0, 0, 1)","rgba(50, 50, 50, 1)","rgba(100, 100, 100, 1)","rgba(117, 117, 117, 1)","rgba(158, 158, 158, 1)","rgba(189, 189, 189, 1)","rgba(224, 224, 224, 1)","rgba(238, 238, 238, 1)","rgba(245, 245, 245, 1)","rgba(255, 255, 255, 1)","rgba(38, 50, 56, 1)","rgba(55, 71, 79, 1)","rgba(69, 90, 100, 1)","rgba(84, 110, 122, 1)","rgba(96, 125, 139, 1)","rgba(120, 144, 156, 1)","rgba(144, 164, 174, 1)","rgba(176, 190, 197, 1)","rgba(207, 216, 220, 1)","rgba(236, 239, 241, 1)","rgba(62, 39, 35, 1)","rgba(78, 52, 46, 1)","rgba(93, 64, 55, 1)","rgba(109, 76, 65, 1)","rgba(121, 85, 72, 1)","rgba(141, 110, 99, 1)","rgba(161, 136, 127, 1)","rgba(188, 170, 164, 1)","rgba(215, 204, 200, 1)","rgba(239, 235, 233, 1)","rgba(191, 54, 12, 1)","rgba(216, 67, 21, 1)","rgba(230, 74, 25, 1)","rgba(244, 81, 30, 1)","rgba(255, 87, 34, 1)","rgba(255, 112, 67, 1)","rgba(255, 138, 101, 1)","rgba(255, 171, 145, 1)","rgba(255, 204, 188, 1)","rgba(251, 233, 231, 1)","rgba(230, 81, 0, 1)","rgba(239, 108, 0, 1)","rgba(245, 124, 0, 1)","rgba(251, 140, 0, 1)","rgba(255, 152, 0, 1)","rgba(255, 167, 38, 1)","rgba(255, 183, 77, 1)","rgba(255, 204, 128, 1)","rgba(255, 224, 178, 1)","rgba(255, 243, 224, 1)","rgba(255, 111, 0, 1)","rgba(255, 143, 0, 1)","rgba(255, 160, 0, 1)","rgba(255, 179, 0, 1)","rgba(255, 193, 7, 1)","rgba(255, 202, 40, 1)","rgba(255, 213, 79, 1)","rgba(255, 224, 130, 1)","rgba(255, 236, 179, 1)","rgba(255, 248, 225, 1)","rgba(245, 127, 23, 1)","rgba(249, 168, 37, 1)","rgba(251, 192, 45, 1)","rgba(253, 216, 53, 1)","rgba(255, 235, 59, 1)","rgba(255, 238, 88, 1)","rgba(255, 241, 118, 1)","rgba(255, 245, 157, 1)","rgba(255, 249, 196, 1)","rgba(255, 253, 231, 1)","rgba(130, 119, 23, 1)","rgba(158, 157, 36, 1)","rgba(175, 180, 43, 1)","rgba(192, 202, 51, 1)","rgba(205, 220, 57, 1)","rgba(212, 225, 87, 1)","rgba(220, 231, 117, 1)","rgba(230, 238, 156, 1)","rgba(240, 244, 195, 1)","rgba(249, 251, 231, 1)","rgba(51, 105, 30, 1)","rgba(85, 139, 47, 1)","rgba(104, 159, 56, 1)","rgba(124, 179, 66, 1)","rgba(139, 195, 74, 1)","rgba(156, 204, 101, 1)","rgba(174, 213, 129, 1)","rgba(197, 225, 165, 1)","rgba(220, 237, 200, 1)","rgba(241, 248, 233, 1)","rgba(27, 94, 32, 1)","rgba(46, 125, 50, 1)","rgba(56, 142, 60, 1)","rgba(67, 160, 71, 1)","rgba(76, 175, 80, 1)","rgba(102, 187, 106, 1)","rgba(129, 199, 132, 1)","rgba(165, 214, 167, 1)","rgba(200, 230, 201, 1)","rgba(232, 245, 233, 1)","rgba(0, 77, 64, 1)","rgba(0, 105, 92, 1)","rgba(0, 121, 107, 1)","rgba(0, 137, 123, 1)","rgba(0, 150, 136, 1)","rgba(38, 166, 154, 1)","rgba(77, 182, 172, 1)","rgba(128, 203, 196, 1)","rgba(178, 223, 219, 1)","rgba(224, 242, 241, 1)","rgba(0, 96, 100, 1)","rgba(0, 131, 143, 1)","rgba(0, 151, 167, 1)","rgba(0, 172, 193, 1)","rgba(0, 188, 212, 1)","rgba(38, 198, 218, 1)","rgba(77, 208, 225, 1)","rgba(128, 222, 234, 1)","rgba(178, 235, 242, 1)","rgba(224, 247, 250, 1)","rgba(1, 87, 155, 1)","rgba(2, 119, 189, 1)","rgba(2, 136, 209, 1)","rgba(3, 155, 229, 1)","rgba(3, 169, 244, 1)","rgba(41, 182, 246, 1)","rgba(79, 195, 247, 1)","rgba(129, 212, 250, 1)","rgba(179, 229, 252, 1)","rgba(225, 245, 254, 1)","rgba(13, 71, 161, 1)","rgba(21, 101, 192, 1)","rgba(25, 118, 210, 1)","rgba(30, 136, 229, 1)","rgba(33, 150, 243, 1)","rgba(66, 165, 245, 1)","rgba(100, 181, 246, 1)","rgba(144, 202, 249, 1)","rgba(187, 222, 251, 1)","rgba(227, 242, 253, 1)","rgba(26, 35, 126, 1)","rgba(40, 53, 147, 1)","rgba(48, 63, 159, 1)","rgba(57, 73, 171, 1)","rgba(63, 81, 181, 1)","rgba(92, 107, 192, 1)","rgba(121, 134, 203, 1)","rgba(159, 168, 218, 1)","rgba(197, 202, 233, 1)","rgba(232, 234, 246, 1)","rgba(49, 27, 146, 1)","rgba(69, 39, 160, 1)","rgba(81, 45, 168, 1)","rgba(94, 53, 177, 1)","rgba(103, 58, 183, 1)","rgba(126, 87, 194, 1)","rgba(149, 117, 205, 1)","rgba(179, 157, 219, 1)","rgba(209, 196, 233, 1)","rgba(237, 231, 246, 1)","rgba(74, 20, 140, 1)","rgba(106, 27, 154, 1)","rgba(123, 31, 162, 1)","rgba(142, 36, 170, 1)","rgba(156, 39, 176, 1)","rgba(171, 71, 188, 1)","rgba(186, 104, 200, 1)","rgba(206, 147, 216, 1)","rgba(225, 190, 231, 1)","rgba(243, 229, 245, 1)","rgba(136, 14, 79, 1)","rgba(173, 20, 87, 1)","rgba(194, 24, 91, 1)","rgba(216, 27, 96, 1)","rgba(233, 30, 99, 1)","rgba(236, 64, 122, 1)","rgba(240, 98, 146, 1)","rgba(244, 143, 177, 1)","rgba(248, 187, 208, 1)","rgba(252, 228, 236, 1)","rgba(183, 28, 28, 1)","rgba(198, 40, 40, 1)","rgba(211, 47, 47, 1)","rgba(229, 57, 53, 1)","rgba(244, 67, 54, 1)","rgba(239, 83, 80, 1)","rgba(229, 115, 115, 1)","rgba(239, 154, 154, 1)","rgba(255, 205, 210, 1)","rgba(255, 235, 238, 1)"],n.historyColorboxs=[];var b=a[l.colorLanguage||"pt"],u=l.colorType||"hex",p="historyColor-"+u,f=angular.element(document.body),d='<div class="colorpicker-mask" ng-show="show" ng-click="select()"></div><div class="colorpicker dropdown" ng-show="show">     <div class="colorpicker-preview">       <div class="inner">       <div class="color-text"></div>       <div class="color-tabs">        <div class="color-tab" ng-class="{true: \'active\', false: \'\'}[colorTab === 1]" ng-click="toggleTab(1)">'+b.PALETTE+'</div>        <div class="color-tab" ng-class="{true: \'active\', false: \'\'}[colorTab === 2]" ng-click="toggleTab(2)">'+b.WHEEL+'</div>        <div class="color-tab" ng-class="{true: \'active\', false: \'\'}[colorTab === 3]" ng-click="toggleTab(3)">'+b.HISTORY+'</div>       </div>       </div>     </div>     <div class="tab-colorbox" ng-show="colorTab ===1">       <div ng-repeat="item in colorboxs">          <div class="color-unit" ng-attr-style="background-color:{{::item}}" ng-class="{true:\'active\',false:\'\'}[color === item]" ng-click="selectColorBox(item,$index)"></div>       </div>     </div>     <div class="tab-slider" ng-show="colorTab ===2">       <div class="colorpicker-saturation"><i></i></div>       <div class="colorpicker-hue"><i></i></div>       <div class="colorpicker-alpha"><i></i></div>     </div>     <div class="tab-historyColorbox" ng-show="colorTab ===3">       <div ng-repeat="item in historyColorboxs">           <div class="color-unit-wrap">               <div class="color-unit" ng-attr-style="background-color:{{::item}}" ng-class="{true:\'active\',false:\'\'}[color === item]" ng-click="selectColorBox(item,$index)"></div>           </div>       </div>     </div>     <div class="btn-group">        <div class="cancel" ng-click="cancel()">'+b.CANCEL+'</div>        <div class="select" ng-click="select()">'+b.SELECT+'</div>     </div>     <div class="colorpicker-caret"></div></div>',v=angular.element(d),h=v.eq(0),m=v.eq(1),k=m.find(".colorpicker-hue"),T=m.find(".colorpicker-saturation"),C=m.find(".colorpicker-preview"),x=m.find("i"),E=m.find(".colorpicker-caret");o(v)(n),f.append(v);var L,w,S,A=e,H=24;n.toggleTab=function(r){n.colorTab=r,B()},n.selectColorBox=function(r,o){A.setColor(r),n.color=A[u](),P()},n.cancel=function(){n.color=w,O("cancel")},n.select=function(){O()};var y=function(){r.on("mousemove",I),r.on("mouseup",R)};"rgba"===u&&(m.addClass("alpha"),L=m.find(".colorpicker-alpha"),L.on("click",function(r){t.setAlpha(r),I(r)}).on("mousedown",function(r){t.setAlpha(r),y()})),k.on("click",function(r){t.setHue(r),I(r)}).on("mousedown",function(r){t.setHue(r),y()}),T.on("click",function(r){t.setSaturation(r),I(r)}).on("mousedown",function(r){t.setSaturation(r),y()});var P=function(){var r=A.value.b>.7?"#000000":"#FFFFFF",o=A[u]();C.find(".color-text").text(o),C.find(".inner").css("backgroundColor",o),C.find(".color-tabs").css("color",r),C.find(".color-text").css("color",r),T.css("backgroundColor",A.toHex(A.value.h,1,1,1)),m.hasClass("position-left")||m.hasClass("position-right")?E.css("border-color",o):E.css("border-color","#fff")},I=function(r){var o=t.getLeftPosition(r),a=t.getTopPosition(r),e=t.getSlider();t.setKnob(a,o),e.callLeft&&A[e.callLeft].call(A,o/200),e.callTop&&A[e.callTop].call(A,a/200),P();var i=A[u]();return m.find(".colorpicker-alpha").css({"background-color":i}),n.$apply(function(){n.color=i}),!1},R=function(){r.off("mousemove",I),r.off("mouseup",R)},B=function(){var r=A[u]();A.setColor(r),x.eq(0).css({left:200*A.value.s+"px",top:200-200*A.value.b+"px"}),m.find(".colorpicker-alpha").css({"background-color":r}),x.eq(1).css("top",200*(1-A.value.h)+"px"),x.eq(2).css("top",200*(1-A.value.a)+"px"),P()},M=function(){var r,o=m.width(),a=m.height(),e=s[0].getBoundingClientRect(),t=e.left,i=e.top,n=($(window).width(),$(window).height());return m.removeClass("position-top"),m.removeClass("position-right"),m.removeClass("position-bottom"),m.removeClass("position-left"),"left"==l.position||!l.position&&t>o&&n-i>=a?(r={top:i-6,left:t-o+10},m.addClass("position-left")):"right"==l.position||!l.position&&t<o&&n-i>=a?(r={top:i-6,left:t+20},m.addClass("position-right")):"top"==l.position||!l.position&&t>o&&n-i<a?(r={top:i-a+35,left:t-o+10},m.addClass("position-top")):(r={top:i-a+35,left:t+20},m.addClass("position-bottom")),{top:r.top+"px",left:r.left+"px"}},Y=function(r){w=angular.copy(n.color),A.setColor(w),B();var o=i.getCookie(p);o=null===o?[]:o.split("|"),n.$apply(function(){n.show=!0,n.historyColorboxs=o}),m.css(M()),h.css({"z-index":parseInt((new Date).getTime(),10)}),m.css({"z-index":parseInt((new Date).getTime(),10)})};s.on("click",Y),m.on("mousedown",function(r){r.stopPropagation(),r.preventDefault()});var O=function(r){n.show=!1,"cancel"!==r&&F()},F=function(){var r=A[u]();if(i.enabledCookie(p)){for(var o=i.getCookie(p),a=o.split("|"),e=0;e<a.length;e++)if(r===a[e])return a.splice(e,1),a.unshift(r),void i.setCookie(p,a.join("|"));a.length>=H?(a.pop(),a.unshift(r),i.setCookie(p,a.join("|"))):i.setCookie(p,r+"|"+o)}else i.setCookie(p,r)};r.bind("scroll",function(){g()}),$(window).on("resize",function(){g()})}}}]);